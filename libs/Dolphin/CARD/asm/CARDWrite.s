.include "macros.s"

.section .text, "ax"  # 0x800058A0 - 0x800764A0 ; 0x00070C00


WriteCallback:
/* 80028BB0 000259D0  7C 08 02 A6 */	mflr r0
/* 80028BB4 000259D4  90 01 00 04 */	stw r0, 0x4(r1)
/* 80028BB8 000259D8  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80028BBC 000259DC  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80028BC0 000259E0  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80028BC4 000259E4  3B C3 00 00 */	addi r30, r3, 0x0
/* 80028BC8 000259E8  3C 60 80 0A */	lis r3, __CARDBlock@ha
/* 80028BCC 000259EC  93 A1 00 14 */	stw r29, 0x14(r1)
/* 80028BD0 000259F0  1C BE 01 10 */	mulli r5, r30, 0x110
/* 80028BD4 000259F4  93 81 00 10 */	stw r28, 0x10(r1)
/* 80028BD8 000259F8  38 03 3D 40 */	addi r0, r3, __CARDBlock@l
/* 80028BDC 000259FC  7C 9C 23 79 */	mr. r28, r4
/* 80028BE0 00025A00  7F E0 2A 14 */	add r31, r0, r5
/* 80028BE4 00025A04  41 80 00 F0 */	blt lbl_80028CD4
/* 80028BE8 00025A08  83 BF 00 C0 */	lwz r29, 0xc0(r31)
/* 80028BEC 00025A0C  80 7D 00 0C */	lwz r3, 0xc(r29)
/* 80028BF0 00025A10  2C 03 00 00 */	cmpwi r3, 0x0
/* 80028BF4 00025A14  40 80 00 0C */	bge lbl_80028C00
/* 80028BF8 00025A18  3B 80 FF F2 */	li r28, -0xe
/* 80028BFC 00025A1C  48 00 00 D8 */	b lbl_80028CD4
lbl_80028C00:
/* 80028C00 00025A20  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 80028C04 00025A24  7C 00 18 50 */	subf r0, r0, r3
/* 80028C08 00025A28  90 1D 00 0C */	stw r0, 0xc(r29)
/* 80028C0C 00025A2C  80 1D 00 0C */	lwz r0, 0xc(r29)
/* 80028C10 00025A30  2C 00 00 00 */	cmpwi r0, 0x0
/* 80028C14 00025A34  41 81 00 54 */	bgt lbl_80028C68
/* 80028C18 00025A38  7F E3 FB 78 */	mr r3, r31
/* 80028C1C 00025A3C  4B FF CC E5 */	bl __CARDGetDirBlock
/* 80028C20 00025A40  80 BD 00 04 */	lwz r5, 0x4(r29)
/* 80028C24 00025A44  3C 80 80 00 */	lis r4, 0x800000F8@ha
/* 80028C28 00025A48  80 04 00 F8 */	lwz r0, 0x800000F8@l(r4)
/* 80028C2C 00025A4C  54 A4 30 32 */	slwi r4, r5, 6
/* 80028C30 00025A50  7F 83 22 14 */	add r28, r3, r4
/* 80028C34 00025A54  54 1D F0 BE */	srwi r29, r0, 2
/* 80028C38 00025A58  48 01 A0 2D */	bl OSGetTime
/* 80028C3C 00025A5C  38 DD 00 00 */	addi r6, r29, 0x0
/* 80028C40 00025A60  38 A0 00 00 */	li r5, 0x0
/* 80028C44 00025A64  4B FD E2 E1 */	bl __div2i
/* 80028C48 00025A68  90 9C 00 28 */	stw r4, 0x28(r28)
/* 80028C4C 00025A6C  38 00 00 00 */	li r0, 0x0
/* 80028C50 00025A70  38 7E 00 00 */	addi r3, r30, 0x0
/* 80028C54 00025A74  80 9F 00 D0 */	lwz r4, 0xd0(r31)
/* 80028C58 00025A78  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 80028C5C 00025A7C  4B FF CE 45 */	bl __CARDUpdateDir
/* 80028C60 00025A80  7C 7C 1B 78 */	mr r28, r3
/* 80028C64 00025A84  48 00 00 68 */	b lbl_80028CCC
lbl_80028C68:
/* 80028C68 00025A88  7F E3 FB 78 */	mr r3, r31
/* 80028C6C 00025A8C  4B FF C8 91 */	bl __CARDGetFatBlock
/* 80028C70 00025A90  80 9D 00 08 */	lwz r4, 0x8(r29)
/* 80028C74 00025A94  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 80028C78 00025A98  7C 04 02 14 */	add r0, r4, r0
/* 80028C7C 00025A9C  90 1D 00 08 */	stw r0, 0x8(r29)
/* 80028C80 00025AA0  A0 1D 00 10 */	lhz r0, 0x10(r29)
/* 80028C84 00025AA4  54 00 08 3C */	slwi r0, r0, 1
/* 80028C88 00025AA8  7C 03 02 2E */	lhzx r0, r3, r0
/* 80028C8C 00025AAC  B0 1D 00 10 */	sth r0, 0x10(r29)
/* 80028C90 00025AB0  A0 9D 00 10 */	lhz r4, 0x10(r29)
/* 80028C94 00025AB4  28 04 00 05 */	cmplwi r4, 0x5
/* 80028C98 00025AB8  41 80 00 10 */	blt lbl_80028CA8
/* 80028C9C 00025ABC  A0 1F 00 10 */	lhz r0, 0x10(r31)
/* 80028CA0 00025AC0  7C 04 00 40 */	cmplw r4, r0
/* 80028CA4 00025AC4  41 80 00 0C */	blt lbl_80028CB0
lbl_80028CA8:
/* 80028CA8 00025AC8  3B 80 FF FA */	li r28, -0x6
/* 80028CAC 00025ACC  48 00 00 28 */	b lbl_80028CD4
lbl_80028CB0:
/* 80028CB0 00025AD0  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 80028CB4 00025AD4  3C 60 80 03 */	lis r3, EraseCallback@ha
/* 80028CB8 00025AD8  38 A3 8D 20 */	addi r5, r3, EraseCallback@l
/* 80028CBC 00025ADC  7C 80 21 D6 */	mullw r4, r0, r4
/* 80028CC0 00025AE0  38 7E 00 00 */	addi r3, r30, 0x0
/* 80028CC4 00025AE4  4B FF AD 81 */	bl __CARDEraseSector
/* 80028CC8 00025AE8  7C 7C 1B 78 */	mr r28, r3
lbl_80028CCC:
/* 80028CCC 00025AEC  2C 1C 00 00 */	cmpwi r28, 0x0
/* 80028CD0 00025AF0  40 80 00 30 */	bge lbl_80028D00
lbl_80028CD4:
/* 80028CD4 00025AF4  83 BF 00 D0 */	lwz r29, 0xd0(r31)
/* 80028CD8 00025AF8  38 00 00 00 */	li r0, 0x0
/* 80028CDC 00025AFC  38 7F 00 00 */	addi r3, r31, 0x0
/* 80028CE0 00025B00  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 80028CE4 00025B04  7F 84 E3 78 */	mr r4, r28
/* 80028CE8 00025B08  4B FF AF E1 */	bl __CARDPutControlBlock
/* 80028CEC 00025B0C  39 9D 00 00 */	addi r12, r29, 0x0
/* 80028CF0 00025B10  7D 88 03 A6 */	mtlr r12
/* 80028CF4 00025B14  38 7E 00 00 */	addi r3, r30, 0x0
/* 80028CF8 00025B18  38 9C 00 00 */	addi r4, r28, 0x0
/* 80028CFC 00025B1C  4E 80 00 21 */	blrl
lbl_80028D00:
/* 80028D00 00025B20  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80028D04 00025B24  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80028D08 00025B28  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 80028D0C 00025B2C  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 80028D10 00025B30  83 81 00 10 */	lwz r28, 0x10(r1)
/* 80028D14 00025B34  38 21 00 20 */	addi r1, r1, 0x20
/* 80028D18 00025B38  7C 08 03 A6 */	mtlr r0
/* 80028D1C 00025B3C  4E 80 00 20 */	blr

EraseCallback:
/* 80028D20 00025B40  7C 08 02 A6 */	mflr r0
/* 80028D24 00025B44  90 01 00 04 */	stw r0, 0x4(r1)
/* 80028D28 00025B48  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80028D2C 00025B4C  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80028D30 00025B50  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80028D34 00025B54  93 A1 00 14 */	stw r29, 0x14(r1)
/* 80028D38 00025B58  7C 9D 23 79 */	mr. r29, r4
/* 80028D3C 00025B5C  93 81 00 10 */	stw r28, 0x10(r1)
/* 80028D40 00025B60  3B 83 00 00 */	addi r28, r3, 0x0
/* 80028D44 00025B64  1C BC 01 10 */	mulli r5, r28, 0x110
/* 80028D48 00025B68  3C 60 80 0A */	lis r3, __CARDBlock@ha
/* 80028D4C 00025B6C  38 03 3D 40 */	addi r0, r3, __CARDBlock@l
/* 80028D50 00025B70  7F E0 2A 14 */	add r31, r0, r5
/* 80028D54 00025B74  41 80 00 30 */	blt lbl_80028D84
/* 80028D58 00025B78  80 9F 00 C0 */	lwz r4, 0xc0(r31)
/* 80028D5C 00025B7C  3C 60 80 03 */	lis r3, WriteCallback@ha
/* 80028D60 00025B80  38 E3 8B B0 */	addi r7, r3, WriteCallback@l
/* 80028D64 00025B84  80 BF 00 0C */	lwz r5, 0xc(r31)
/* 80028D68 00025B88  A0 04 00 10 */	lhz r0, 0x10(r4)
/* 80028D6C 00025B8C  80 DF 00 B4 */	lwz r6, 0xb4(r31)
/* 80028D70 00025B90  38 7C 00 00 */	addi r3, r28, 0x0
/* 80028D74 00025B94  7C 85 01 D6 */	mullw r4, r5, r0
/* 80028D78 00025B98  4B FF C7 21 */	bl __CARDWrite
/* 80028D7C 00025B9C  7C 7D 1B 79 */	mr. r29, r3
/* 80028D80 00025BA0  40 80 00 30 */	bge lbl_80028DB0
lbl_80028D84:
/* 80028D84 00025BA4  83 DF 00 D0 */	lwz r30, 0xd0(r31)
/* 80028D88 00025BA8  38 00 00 00 */	li r0, 0x0
/* 80028D8C 00025BAC  38 7F 00 00 */	addi r3, r31, 0x0
/* 80028D90 00025BB0  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 80028D94 00025BB4  7F A4 EB 78 */	mr r4, r29
/* 80028D98 00025BB8  4B FF AF 31 */	bl __CARDPutControlBlock
/* 80028D9C 00025BBC  39 9E 00 00 */	addi r12, r30, 0x0
/* 80028DA0 00025BC0  7D 88 03 A6 */	mtlr r12
/* 80028DA4 00025BC4  38 7C 00 00 */	addi r3, r28, 0x0
/* 80028DA8 00025BC8  38 9D 00 00 */	addi r4, r29, 0x0
/* 80028DAC 00025BCC  4E 80 00 21 */	blrl
lbl_80028DB0:
/* 80028DB0 00025BD0  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80028DB4 00025BD4  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80028DB8 00025BD8  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 80028DBC 00025BDC  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 80028DC0 00025BE0  83 81 00 10 */	lwz r28, 0x10(r1)
/* 80028DC4 00025BE4  38 21 00 20 */	addi r1, r1, 0x20
/* 80028DC8 00025BE8  7C 08 03 A6 */	mtlr r0
/* 80028DCC 00025BEC  4E 80 00 20 */	blr

.global CARDWriteAsync
CARDWriteAsync:
/* 80028DD0 00025BF0  7C 08 02 A6 */	mflr r0
/* 80028DD4 00025BF4  90 01 00 04 */	stw r0, 0x4(r1)
/* 80028DD8 00025BF8  94 21 FF C8 */	stwu r1, -0x38(r1)
/* 80028DDC 00025BFC  BF 61 00 24 */	stmw r27, 0x24(r1)
/* 80028DE0 00025C00  3B 86 00 00 */	addi r28, r6, 0x0
/* 80028DE4 00025C04  3B 65 00 00 */	addi r27, r5, 0x0
/* 80028DE8 00025C08  3B E4 00 00 */	addi r31, r4, 0x0
/* 80028DEC 00025C0C  3B C3 00 00 */	addi r30, r3, 0x0
/* 80028DF0 00025C10  3B A7 00 00 */	addi r29, r7, 0x0
/* 80028DF4 00025C14  38 9B 00 00 */	addi r4, r27, 0x0
/* 80028DF8 00025C18  38 BC 00 00 */	addi r5, r28, 0x0
/* 80028DFC 00025C1C  38 C1 00 1C */	addi r6, r1, 0x1c
/* 80028E00 00025C20  4B FF F9 39 */	bl __CARDSeek
/* 80028E04 00025C24  2C 03 00 00 */	cmpwi r3, 0x0
/* 80028E08 00025C28  40 80 00 08 */	bge lbl_80028E10
/* 80028E0C 00025C2C  48 00 00 C4 */	b lbl_80028ED0
lbl_80028E10:
/* 80028E10 00025C30  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80028E14 00025C34  80 83 00 0C */	lwz r4, 0xc(r3)
/* 80028E18 00025C38  38 84 FF FF */	addi r4, r4, -0x1
/* 80028E1C 00025C3C  7F 80 20 39 */	and. r0, r28, r4
/* 80028E20 00025C40  40 82 00 0C */	bne lbl_80028E2C
/* 80028E24 00025C44  7F 60 20 39 */	and. r0, r27, r4
/* 80028E28 00025C48  41 82 00 10 */	beq lbl_80028E38
lbl_80028E2C:
/* 80028E2C 00025C4C  38 80 FF 80 */	li r4, -0x80
/* 80028E30 00025C50  4B FF AE 99 */	bl __CARDPutControlBlock
/* 80028E34 00025C54  48 00 00 9C */	b lbl_80028ED0
lbl_80028E38:
/* 80028E38 00025C58  4B FF CA C9 */	bl __CARDGetDirBlock
/* 80028E3C 00025C5C  80 1E 00 04 */	lwz r0, 0x4(r30)
/* 80028E40 00025C60  54 00 30 32 */	slwi r0, r0, 6
/* 80028E44 00025C64  7C 83 02 14 */	add r4, r3, r0
/* 80028E48 00025C68  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80028E4C 00025C6C  4B FF F0 09 */	bl __CARDAccess
/* 80028E50 00025C70  7C 64 1B 79 */	mr. r4, r3
/* 80028E54 00025C74  40 80 00 10 */	bge lbl_80028E64
/* 80028E58 00025C78  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80028E5C 00025C7C  4B FF AE 6D */	bl __CARDPutControlBlock
/* 80028E60 00025C80  48 00 00 70 */	b lbl_80028ED0
lbl_80028E64:
/* 80028E64 00025C84  38 7F 00 00 */	addi r3, r31, 0x0
/* 80028E68 00025C88  38 9B 00 00 */	addi r4, r27, 0x0
/* 80028E6C 00025C8C  48 01 3C E5 */	bl DCStoreRange
/* 80028E70 00025C90  28 1D 00 00 */	cmplwi r29, 0x0
/* 80028E74 00025C94  41 82 00 0C */	beq lbl_80028E80
/* 80028E78 00025C98  7F A0 EB 78 */	mr r0, r29
/* 80028E7C 00025C9C  48 00 00 0C */	b lbl_80028E88
lbl_80028E80:
/* 80028E80 00025CA0  3C 60 80 02 */	lis r3, __CARDDefaultApiCallback@ha
/* 80028E84 00025CA4  38 03 2C B0 */	addi r0, r3, __CARDDefaultApiCallback@l
lbl_80028E88:
/* 80028E88 00025CA8  80 81 00 1C */	lwz r4, 0x1c(r1)
/* 80028E8C 00025CAC  3C 60 80 03 */	lis r3, EraseCallback@ha
/* 80028E90 00025CB0  38 A3 8D 20 */	addi r5, r3, EraseCallback@l
/* 80028E94 00025CB4  90 04 00 D0 */	stw r0, 0xd0(r4)
/* 80028E98 00025CB8  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80028E9C 00025CBC  93 E3 00 B4 */	stw r31, 0xb4(r3)
/* 80028EA0 00025CC0  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80028EA4 00025CC4  A0 1E 00 10 */	lhz r0, 0x10(r30)
/* 80028EA8 00025CC8  80 83 00 0C */	lwz r4, 0xc(r3)
/* 80028EAC 00025CCC  80 7E 00 00 */	lwz r3, 0x0(r30)
/* 80028EB0 00025CD0  7C 84 01 D6 */	mullw r4, r4, r0
/* 80028EB4 00025CD4  4B FF AB 91 */	bl __CARDEraseSector
/* 80028EB8 00025CD8  7C 7E 1B 79 */	mr. r30, r3
/* 80028EBC 00025CDC  40 80 00 10 */	bge lbl_80028ECC
/* 80028EC0 00025CE0  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80028EC4 00025CE4  7F C4 F3 78 */	mr r4, r30
/* 80028EC8 00025CE8  4B FF AE 01 */	bl __CARDPutControlBlock
lbl_80028ECC:
/* 80028ECC 00025CEC  7F C3 F3 78 */	mr r3, r30
lbl_80028ED0:
/* 80028ED0 00025CF0  BB 61 00 24 */	lmw r27, 0x24(r1)
/* 80028ED4 00025CF4  80 01 00 3C */	lwz r0, 0x3c(r1)
/* 80028ED8 00025CF8  38 21 00 38 */	addi r1, r1, 0x38
/* 80028EDC 00025CFC  7C 08 03 A6 */	mtlr r0
/* 80028EE0 00025D00  4E 80 00 20 */	blr
