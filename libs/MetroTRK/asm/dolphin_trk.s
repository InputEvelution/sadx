.include "macros.s"

.section .text, "ax"  # 0x800058A0 - 0x800764A0 ; 0x00070C00


.global InitMetroTRK
InitMetroTRK:
/* 8001A630 00017450  38 21 FF FC */	addi r1, r1, -0x4
/* 8001A634 00017454  90 61 00 00 */	stw r3, 0x0(r1)
/* 8001A638 00017458  3C 60 80 08 */	lis r3, gTRKCPUState@h
/* 8001A63C 0001745C  60 63 85 C0 */	ori r3, r3, gTRKCPUState@l
/* 8001A640 00017460  BC 03 00 00 */	stmw r0, 0x0(r3)
/* 8001A644 00017464  80 81 00 00 */	lwz r4, 0x0(r1)
/* 8001A648 00017468  38 21 00 04 */	addi r1, r1, 0x4
/* 8001A64C 0001746C  90 23 00 04 */	stw r1, 0x4(r3)
/* 8001A650 00017470  90 83 00 0C */	stw r4, 0xc(r3)
/* 8001A654 00017474  7C 88 02 A6 */	mflr r4
/* 8001A658 00017478  90 83 00 84 */	stw r4, 0x84(r3)
/* 8001A65C 0001747C  90 83 00 80 */	stw r4, 0x80(r3)
/* 8001A660 00017480  7C 80 00 26 */	mfcr r4
/* 8001A664 00017484  90 83 00 88 */	stw r4, 0x88(r3)
/* 8001A668 00017488  7C 80 00 A6 */	mfmsr r4
/* 8001A66C 0001748C  60 83 80 00 */	ori r3, r4, 0x8000
/* 8001A670 00017490  68 63 80 00 */	xori r3, r3, 0x8000
/* 8001A674 00017494  7C 60 01 24 */	mtmsr r3
/* 8001A678 00017498  7C 9B 03 A6 */	mtspr 27, r4
/* 8001A67C 0001749C  48 00 00 F5 */	bl TRKSaveExtended1Block
/* 8001A680 000174A0  3C 60 80 08 */	lis r3, gTRKCPUState@h
/* 8001A684 000174A4  60 63 85 C0 */	ori r3, r3, gTRKCPUState@l
/* 8001A688 000174A8  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 8001A68C 000174AC  38 00 00 00 */	li r0, 0x0
/* 8001A690 000174B0  7C 12 FB A6 */	mtspr 1010, r0
/* 8001A694 000174B4  7C 15 FB A6 */	mtspr 1013, r0
/* 8001A698 000174B8  3C 20 80 0D */	lis r1, 0x800D7148@h
/* 8001A69C 000174BC  60 21 71 48 */	ori r1, r1, 0x800D7148@l
/* 8001A6A0 000174C0  7C A3 2B 78 */	mr r3, r5
/* 8001A6A4 000174C4  48 00 07 FD */	bl InitMetroTRKCommTable
/* 8001A6A8 000174C8  2C 03 00 01 */	cmpwi r3, 0x1
/* 8001A6AC 000174CC  40 82 00 14 */	bne lbl_8001A6C0
/* 8001A6B0 000174D0  80 83 00 84 */	lwz r4, 0x84(r3)
/* 8001A6B4 000174D4  7C 88 03 A6 */	mtlr r4
/* 8001A6B8 000174D8  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 8001A6BC 000174DC  4E 80 00 20 */	blr
lbl_8001A6C0:
/* 8001A6C0 000174E0  48 00 04 28 */	b TRK_main

.global TRKInitializeTarget
TRKInitializeTarget:
/* 8001A6C4 000174E4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8001A6C8 000174E8  7C 08 02 A6 */	mflr r0
/* 8001A6CC 000174EC  3C 60 80 09 */	lis r3, gTRKState@ha
/* 8001A6D0 000174F0  90 01 00 14 */	stw r0, 0x14(r1)
/* 8001A6D4 000174F4  38 00 00 01 */	li r0, 0x1
/* 8001A6D8 000174F8  38 63 85 1C */	addi r3, r3, gTRKState@l
/* 8001A6DC 000174FC  90 03 00 98 */	stw r0, 0x98(r3)
/* 8001A6E0 00017500  4B FF E6 A1 */	bl __TRK_get_MSR
/* 8001A6E4 00017504  3C A0 80 09 */	lis r5, gTRKState@ha
/* 8001A6E8 00017508  3C 80 80 09 */	lis r4, lc_base@ha
/* 8001A6EC 0001750C  38 A5 85 1C */	addi r5, r5, gTRKState@l
/* 8001A6F0 00017510  3C 00 E0 00 */	lis r0, 0xe000
/* 8001A6F4 00017514  90 65 00 8C */	stw r3, 0x8c(r5)
/* 8001A6F8 00017518  38 60 00 00 */	li r3, 0x0
/* 8001A6FC 0001751C  90 04 8A 98 */	stw r0, lc_base@l(r4)
/* 8001A700 00017520  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8001A704 00017524  7C 08 03 A6 */	mtlr r0
/* 8001A708 00017528  38 21 00 10 */	addi r1, r1, 0x10
/* 8001A70C 0001752C  4E 80 00 20 */	blr

.global TRKTargetTranslate
TRKTargetTranslate:
/* 8001A710 00017530  3C 80 80 09 */	lis r4, lc_base@ha
/* 8001A714 00017534  38 84 8A 98 */	addi r4, r4, lc_base@l
/* 8001A718 00017538  80 84 00 00 */	lwz r4, 0x0(r4)
/* 8001A71C 0001753C  7C 03 20 40 */	cmplw r3, r4
/* 8001A720 00017540  41 80 00 24 */	blt lbl_8001A744
/* 8001A724 00017544  38 04 40 00 */	addi r0, r4, 0x4000
/* 8001A728 00017548  7C 03 00 40 */	cmplw r3, r0
/* 8001A72C 0001754C  40 80 00 18 */	bge lbl_8001A744
/* 8001A730 00017550  3C 80 80 09 */	lis r4, gTRKCPUState@ha
/* 8001A734 00017554  38 84 85 C0 */	addi r4, r4, gTRKCPUState@l
/* 8001A738 00017558  80 04 02 38 */	lwz r0, 0x238(r4)
/* 8001A73C 0001755C  54 00 07 BF */	clrlwi. r0, r0, 30
/* 8001A740 00017560  4C 82 00 20 */	bnelr
lbl_8001A744:
/* 8001A744 00017564  54 60 00 BE */	clrlwi r0, r3, 2
/* 8001A748 00017568  64 03 80 00 */	oris r3, r0, 0x8000
/* 8001A74C 0001756C  4E 80 00 20 */	blr

.global EnableMetroTRKInterrupts
EnableMetroTRKInterrupts:
/* 8001A750 00017570  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8001A754 00017574  7C 08 02 A6 */	mflr r0
/* 8001A758 00017578  90 01 00 14 */	stw r0, 0x14(r1)
/* 8001A75C 0001757C  48 00 06 D9 */	bl EnableEXI2Interrupts
/* 8001A760 00017580  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8001A764 00017584  7C 08 03 A6 */	mtlr r0
/* 8001A768 00017588  38 21 00 10 */	addi r1, r1, 0x10
/* 8001A76C 0001758C  4E 80 00 20 */	blr


.section .data, "wa"  # 0x80079C60 - 0x80085B20 ; 0x0000BEC0

.balign 8

.global TRK_ISR_OFFSETS
TRK_ISR_OFFSETS:

	# ROM: 0x779A0
	.4byte 0x00000100
	.4byte 0x00000200
	.4byte 0x00000300
	.4byte 0x00000400
	.4byte 0x00000500
	.4byte 0x00000600
	.4byte 0x00000700
	.4byte 0x00000800
	.4byte 0x00000900
	.4byte 0x00000C00
	.4byte 0x00000D00
	.4byte 0x00000F00
	.4byte 0x00001300
	.4byte 0x00001400
	.4byte 0x00001700


.section .bss, "", @nobits  # 0x80085B20 - 0x800C3E60 ; 0x0003E340

.balign 8

.global lc_base
lc_base:
	.skip 0x4
